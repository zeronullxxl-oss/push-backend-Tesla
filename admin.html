<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Push Admin ‚Äî Tesla Mindledge</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background:#0a0f0f; color:#e3e3e3; min-height:100vh; padding:20px; }
  .container { max-width:700px; margin:0 auto; }
  h1 { font-size:24px; font-weight:600; margin-bottom:8px; color:#fff; }
  .subtitle { color:#8e8e93; font-size:14px; margin-bottom:30px; }

  /* Stats */
  .stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:12px; margin-bottom:30px; }
  .stat-card { background:#1a1f2e; border-radius:14px; padding:18px 16px; text-align:center; }
  .stat-val { font-size:28px; font-weight:700; color:#fff; }
  .stat-label { font-size:12px; color:#8e8e93; margin-top:4px; }

  /* Form */
  .form-group { margin-bottom:16px; }
  label { display:block; font-size:13px; color:#8e8e93; margin-bottom:6px; }
  input, textarea { width:100%; padding:12px 16px; background:#1a1f2e; border:1px solid #2a2f3e; border-radius:10px; color:#fff; font-size:15px; outline:none; transition:border .2s; }
  input:focus, textarea:focus { border-color:#E5001B; }
  textarea { resize:vertical; min-height:80px; }
  .btn { display:inline-block; padding:12px 24px; border:none; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer; transition:all .2s; margin-right:8px; margin-bottom:8px; }
  .btn-primary { background:#E5001B; color:#fff; }
  .btn-primary:hover { background:#cc0018; transform:translateY(-1px); }
  .btn-secondary { background:#1a1f2e; color:#e3e3e3; border:1px solid #2a2f3e; }
  .btn-secondary:hover { background:#252a3a; }

  /* Quick buttons */
  .quick-section { margin-top:30px; }
  .quick-section h3 { font-size:16px; margin-bottom:14px; color:#fff; }
  .quick-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
  .quick-btn { padding:14px 12px; background:#1a1f2e; border:1px solid #2a2f3e; border-radius:12px; color:#e3e3e3; cursor:pointer; font-size:13px; text-align:left; transition:all .2s; }
  .quick-btn:hover { background:#252a3a; border-color:#E5001B; }
  .quick-btn .qb-emoji { font-size:20px; display:block; margin-bottom:6px; }
  .quick-btn .qb-title { font-weight:600; font-size:14px; }
  .quick-btn .qb-desc { color:#8e8e93; font-size:11px; margin-top:2px; }

  /* Log */
  .log { margin-top:30px; }
  .log h3 { font-size:16px; margin-bottom:10px; color:#fff; }
  #logOutput { background:#111620; border-radius:10px; padding:14px; font-family:'SF Mono',monospace; font-size:12px; color:#8e8e93; max-height:200px; overflow-y:auto; white-space:pre-wrap; }
  .log-success { color:#34c759; }
  .log-error { color:#ff453a; }
  .log-info { color:#0a84ff; }
</style>
</head>
<body>
<div class="container">
  <h1>üîî Push Admin</h1>
  <div class="subtitle">Tesla Mindledge ‚Äî Push Notification Manager</div>

  <!-- Stats -->
  <div class="stats">
    <div class="stat-card"><div class="stat-val" id="statSubs">‚Äî</div><div class="stat-label">Subscribers</div></div>
    <div class="stat-card"><div class="stat-val" id="statSent">‚Äî</div><div class="stat-label">Total Sent</div></div>
    <div class="stat-card"><div class="stat-val" id="statFailed">‚Äî</div><div class="stat-label">Failed</div></div>
    <div class="stat-card"><div class="stat-val" id="statLast">‚Äî</div><div class="stat-label">Last Sent</div></div>
  </div>

  <!-- Custom Push -->
  <form id="pushForm">
    <div class="form-group"><label>Title</label><input type="text" id="pushTitle" placeholder="Tesla Mindledge" value="Tesla Mindledge"></div>
    <div class="form-group"><label>Body</label><textarea id="pushBody" placeholder="Your message..."></textarea></div>
    <div class="form-group"><label>URL (optional)</label><input type="text" id="pushUrl" placeholder="/platform.html"></div>
    <div class="form-group"><label>Image URL (optional)</label><input type="text" id="pushImage" placeholder="https://..."></div>
    <button type="submit" class="btn btn-primary">üì§ Send Push</button>
    <button type="button" class="btn btn-secondary" onclick="loadStats()">üîÑ Refresh Stats</button>
  </form>

  <!-- Quick Buttons -->
  <div class="quick-section">
    <h3>‚ö° Quick Push</h3>
    <div class="quick-grid">
      <div class="quick-btn" onclick="quickSend('üìà Market Alert','BTC surged +5.2% in the last hour. Open Mindledge to check your portfolio.')">
        <span class="qb-emoji">üìà</span><span class="qb-title">Market Up</span><div class="qb-desc">BTC surged +5.2%</div>
      </div>
      <div class="quick-btn" onclick="quickSend('üìâ Price Drop Alert','Major correction detected. Review your positions now.')">
        <span class="qb-emoji">üìâ</span><span class="qb-title">Price Drop</span><div class="qb-desc">Major correction alert</div>
      </div>
      <div class="quick-btn" onclick="quickSend('ü§ñ AI Signal','New high-confidence trading signal available. Don\'t miss this opportunity!')">
        <span class="qb-emoji">ü§ñ</span><span class="qb-title">AI Signal</span><div class="qb-desc">New trading signal</div>
      </div>
      <div class="quick-btn" onclick="quickSend('üí∞ Profit Alert','Your AI trade just closed with +12.3% profit! Check your dashboard.')">
        <span class="qb-emoji">üí∞</span><span class="qb-title">Profit</span><div class="qb-desc">Trade closed +12.3%</div>
      </div>
      <div class="quick-btn" onclick="quickSend('üî• Limited Offer','Exclusive: Premium analytics unlocked for 24 hours. Activate now!')">
        <span class="qb-emoji">üî•</span><span class="qb-title">Promo</span><div class="qb-desc">Limited time offer</div>
      </div>
      <div class="quick-btn" onclick="quickSend('üöÄ Platform Update','New features added: Advanced charting, AI predictions & more.')">
        <span class="qb-emoji">üöÄ</span><span class="qb-title">Update</span><div class="qb-desc">New features available</div>
      </div>
    </div>
  </div>

  <!-- Log -->
  <div class="log">
    <h3>üìã Log</h3>
    <div id="logOutput">Ready.\n</div>
  </div>
</div>

<script>
  const logEl = document.getElementById('logOutput');
  function log(msg, cls='') { 
    const span = document.createElement('span');
    span.className = cls;
    span.textContent = `[${new Date().toLocaleTimeString()}] ${msg}\n`;
    logEl.appendChild(span);
    logEl.scrollTop = logEl.scrollHeight;
  }

  async function loadStats() {
    try {
      const res = await fetch('/api/stats');
      const d = await res.json();
      document.getElementById('statSubs').textContent = d.subscribers;
      document.getElementById('statSent').textContent = d.totalSent;
      document.getElementById('statFailed').textContent = d.totalFailed;
      document.getElementById('statLast').textContent = d.lastSent ? new Date(d.lastSent).toLocaleTimeString() : '‚Äî';
      log('Stats loaded', 'log-info');
    } catch(e) { log('Failed to load stats: ' + e.message, 'log-error'); }
  }

  async function sendPush(title, body, url, image) {
    try {
      log(`Sending: "${title}" ‚Äî ${body}`, 'log-info');
      const res = await fetch('/api/send', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ title, body, url: url || '/', image: image || undefined })
      });
      const d = await res.json();
      log(`‚úÖ Sent: ${d.sent}, Failed: ${d.failed}, Subscribers: ${d.totalSubscribers}`, 'log-success');
      loadStats();
    } catch(e) { log('‚ùå Send error: ' + e.message, 'log-error'); }
  }

  function quickSend(title, body) {
    sendPush(title, body, '/platform.html');
  }

  document.getElementById('pushForm').addEventListener('submit', async e => {
    e.preventDefault();
    const title = document.getElementById('pushTitle').value.trim();
    const body = document.getElementById('pushBody').value.trim();
    const url = document.getElementById('pushUrl').value.trim();
    const image = document.getElementById('pushImage').value.trim();
    if (!title || !body) return log('‚ö†Ô∏è Title and body required', 'log-error');
    await sendPush(title, body, url, image);
  });

  loadStats();
  setInterval(loadStats, 30000);
</script>
</body>
</html>
